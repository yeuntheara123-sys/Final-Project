{% extends  'Front/master.html'%}

{% block content %}
    <div class="container">
    {# top slider#}
    <div class="row">
        <div class="col-12 mt-2 mb-2">
            <div id="carouselExampleCaptions" class="carousel slide" data-ride="carousel">
  <ol class="carousel-indicators">
    <li data-target="#carouselExampleCaptions" data-slide-to="0" class="active"></li>
    <li data-target="#carouselExampleCaptions" data-slide-to="1"></li>
    <li data-target="#carouselExampleCaptions" data-slide-to="2"></li>
  </ol>
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src="/static/Slider/1.jpg" style="height: 400px; object-fit: cover " class="d-block w-100" alt="...">
      <div class="carousel-caption d-none d-md-block">
        <h5>First slide label</h5>
        <p>Some representative placeholder content for the first slide.</p>
      </div>
    </div>
    <div class="carousel-item">
      <img src="/static/Slider/2.jpg" style="height: 400px; object-fit: cover " class="d-block w-100" alt="...">
      <div class="carousel-caption d-none d-md-block">
        <h5>Second slide label</h5>
        <p>Some representative placeholder content for the second slide.</p>
      </div>
    </div>
    <div class="carousel-item">
      <img src="/static/Slider/3.jpg" style="height: 400px; object-fit: cover " class="d-block w-100" alt="...">
      <div class="carousel-caption d-none d-md-block">
        <h5>Third slide label</h5>
        <p>Some representative placeholder content for the third slide.</p>
      </div>
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-target="#carouselExampleCaptions" data-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="sr-only">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-target="#carouselExampleCaptions" data-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="sr-only">Next</span>
  </button>
</div>
        </div>

        {# product card #}
    <div class="product-grid">
          {% for product in products %}
          <div class="product-card">
            <img src="{{ product.image }}" alt="{{ product.title }}" class="product-image">
            <div class="product-details">
              <h3 class="product-title">{{ product.title }}</h3>
              <p class="product-category text-muted">{{ product.category }}</p>
              <p class="product-price">${{ "%.2f"|format(product.price) }}</p>
              <button @click="addToCart({{ product | tojson }})" class="add-to-cart">
                <i class="fas fa-cart-plus"></i> Add to Cart
              </button>
              <div class="quantity-controls mt-2" v-if="isInCart({{ product.id }})">
                <button @click="decreaseQuantity({{ product.id }})" class="btn btn-sm btn-outline-secondary">
                  <i class="fas fa-minus"></i>
                </button>
                <button @click="increaseQuantity({{ product.id }})" class="btn btn-sm btn-outline-secondary">
                  <i class="fas fa-plus"></i>
                </button>
              </div>
            </div>
          </div>
          {% endfor %}
    </div>
        </div>
    </div>

<style>
    .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
    }

    .product-card {
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
        transition: transform 0.3s ease;
    }

    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .product-image {
        width: 100%;
        height: 200px;
        object-fit: contain;
        padding: 10px;
        background: #f8f9fa;
    }

    .product-details {
        padding: 15px;
    }

    .product-title {
        font-size: 1.1rem;
        margin-bottom: 5px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .product-price {
        font-weight: bold;
        font-size: 1.2rem;
        color: #28a745;
        margin: 10px 0;
    }

    .add-to-cart {
        width: 100%;
        padding: 8px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .add-to-cart:hover {
        background-color: #0056b3;
    }

    .quantity-controls {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .cart-summary {
        position: sticky;
        top: 10px;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
</style>

{% endblock %}

{% block custom_script %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const app = Vue.createApp({
    delimiters: ['[[', ']]'],
    data() {
      return {
        cartItems: JSON.parse(localStorage.getItem('cartItems')) || [],
        viewCart: false
      }
    },
    computed: {
      cartTotal() {
        return this.cartItems.reduce((total, item) => {
          return total + (item.price * item.quantity);
        }, 0);
      },
      cartItemCount() {
        return this.cartItems.reduce((count, item) => count + item.quantity, 0);
      }
    },
    methods: {
      addToCart(product) {
        const existingItem = this.cartItems.find(item => item.id === product.id);

        if (existingItem) {
          existingItem.quantity += 1;
        } else {
          this.cartItems.push({
            ...product,
            quantity: 1
          });
        }

        this.saveCart();
        this.showNotification('Added to cart', 'success');
      },
      removeFromCart(index) {
        this.cartItems.splice(index, 1);
        this.saveCart();
        this.showNotification('Removed from cart', 'warning');
      },
      increaseQuantity(productId) {
        const item = this.cartItems.find(item => item.id === productId);
        if (item) {
          item.quantity += 1;
          this.saveCart();
        }
      },
      decreaseQuantity(productId) {
        const item = this.cartItems.find(item => item.id === productId);
        if (item) {
          if (item.quantity > 1) {
            item.quantity -= 1;
          } else {
            this.cartItems = this.cartItems.filter(i => i.id !== productId);
          }
          this.saveCart();
        }
      },
      isInCart(productId) {
        return this.cartItems.some(item => item.id === productId);
      },
      getCartItem(productId) {
        return this.cartItems.find(item => item.id === productId) || { quantity: 0 };
      },
      saveCart() {
        try {
          localStorage.setItem('cartItems', JSON.stringify(this.cartItems));
        } catch (e) {
          console.error('Failed to save cart:', e);
          this.showNotification('Failed to save cart', 'error');
        }
      },
      clearCart() {
        this.cartItems = [];
        this.saveCart();
        this.showNotification('Cart cleared', 'info');
      },
      showNotification(message, type) {
        // You can replace this with Toast/Swal or any notification system
        console.log(`${type}: ${message}`);
      },
      toggleCartView() {
        this.viewCart = !this.viewCart;
      }
    },
    mounted() {
      console.log('Cart initialized');
    }
  });

  app.mount('#app');
});
</script>
{% endblock %}